# Rebuild v3 without f-string to avoid brace escaping issues
import base64

logo_path = "/mnt/data/ê·¸ë¦¼1.png"
with open(logo_path, "rb") as f:
    b64 = base64.b64encode(f.read()).decode("ascii")
data_uri = f"data:image/png;base64,{b64}"

html_template = """<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê±°ë¶ì‹ë‹¹ | ì£¼ê°„ ì‹ë‹¨ Â· ë‰´ìŠ¤ Â· ì»¤ë®¤ë‹ˆí‹°</title>
  <meta name="description" content="ê±°ë¶ì‹ë‹¹ â€” ëª¨ë°”ì¼ ë°˜ì‘í˜•: ë‹¹ì¼/ì£¼ê°„ ì‹ë‹¨, ì œì¡°ì—…Â·ê²½ì œÂ·ì‚¬íšŒ ë‰´ìŠ¤, ì»¤ë®¤ë‹ˆí‹°" />
  <style>
    /* --- Peach (logo background) theme --- */
    :root{
      --bg:#F4EDE3;
      --surface:#FFFFFF;
      --muted:#6B7280;
      --text:#1E2930;
      --line:#E5DCD0;
      --accent:#145A64;
      --accent-ink:#FFFFFF;
      --chip:#F7F2EA;
      --danger:#DC2626;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,system-ui,sans-serif; line-height:1.6}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .border{border:1px solid var(--line)}
    .rounded{border-radius:14px} .rounded-xl{border-radius:18px} .rounded-2xl{border-radius:24px}
    .muted{color:var(--muted)}
    .card{background:var(--surface);border:1px solid var(--line);border-radius:18px;padding:16px}
    .chip{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--line);font-size:12px;color:#475569}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:12px;border:1px solid var(--line);
      background:#fff;color:var(--text);cursor:pointer;transition:.2s;font-weight:600}
    .btn:hover{filter:brightness(1.03)}
    .btn-accent{background:var(--accent);color:var(--accent-ink);border-color:transparent}
    .btn-danger{background:var(--danger);color:#fff;border-color:transparent}
    .input, .select, .textarea{width:100%;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid var(--line);color:var(--text)}
    .textarea{min-height:100px;resize:vertical}

    header.sticky{position:sticky;top:0;z-index:40;background:rgba(244,237,227,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    nav a{padding:12px 10px;display:inline-block;color:#334155}
    nav a:hover{color:#111}
    .logo{display:flex;align-items:center;gap:10px}
    .logo img{height:36px;width:auto}

    h1{font-size:28px;margin:10px 0}@media(min-width:768px){h1{font-size:36px}}
    h2{font-size:22px;margin:0 0 10px}@media(min-width:768px){h2{font-size:28px}}
    h3{font-size:18px;margin:0 0 6px}

    .grid{display:grid;gap:14px}
    .g2{grid-template-columns:1fr}@media(min-width:880px){.g2{grid-template-columns:1fr 1fr}}
    .g3{grid-template-columns:1fr}@media(min-width:980px){.g3{grid-template-columns:1fr 1fr 1fr}}

    /* --- Intro banner --- */
    .intro{padding:18px 0}
    .intro .box{background:var(--surface);border:1px solid var(--line);border-radius:18px;padding:16px;display:flex;gap:14px;align-items:flex-start}
    .intro .box img{height:46px;width:auto}

    /* --- Category bar --- */
    .cats{padding:8px 0}
    .catbar{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media(min-width:720px){ .catbar{grid-template-columns:repeat(6,1fr)} }
    .cat{display:flex;align-items:center;justify-content:center;background:var(--surface);border:1px solid var(--line);border-radius:14px;padding:10px;min-height:66px}
    .cat span{font-weight:700;color:#0f172a}
    .cat img{height:36px;width:auto}

    /* --- Ad block --- */
    .ad-wrap{padding:8px 0}
    .ad-slot{display:flex;align-items:center;justify-content:center}
    .ad-content{width:100%;max-width:320px;height:100px;border-radius:12px;border:1px dashed #94a3b8;background:#fff;color:#64748b;
      display:flex;align-items:center;justify-content:center;font-size:12px;text-align:center;padding:6px}
    @media(min-width:980px){ .ad-content{max-width:728px;height:90px} }

    /* --- Sections --- */
    section{scroll-margin-top:84px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:8px}
    .tabs{display:flex;gap:4px;background:#fff;border:1px solid var(--line);padding:4px;border-radius:12px}
    .tab{padding:8px 12px;border-radius:8px;cursor:pointer;color:#334155}
    .tab[aria-selected="true"]{background:var(--accent);color:#fff;font-weight:700}
    .weekday{display:grid;grid-template-columns:1fr;gap:8px}@media(min-width:600px){.weekday{grid-template-columns:repeat(3,1fr)}}
    .meal{background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px}
    .news-card, .post{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px}
    footer{border-top:1px solid var(--line);padding:28px 0;margin-top:40px}
    .hidden{display:none}
  </style>
</head>
<body>
  <!-- Sticky header (nav only) -->
  <header class="sticky">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
      <nav>
        <a href="#menu">ì‹ë‹¨</a>
        <a href="#news">NEWS</a>
        <a href="#board">ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="#voices">í˜„ì¥ì˜ ì†Œë¦¬</a>
        <a href="#admin">ê´€ë¦¬</a>
      </nav>
      <div class="chip">ëª¨ë°”ì¼ ë°˜ì‘í˜•</div>
    </div>
  </header>

  <!-- 1) Top intro notice -->
  <section class="intro">
    <div class="container">
      <div class="box">
        <img src="__LOGO__" alt="ê±°ë¶ì‹ë‹¹ ë¡œê³ " />
        <div>
          <strong>ê±°ë¶ì‹ë‹¹ ì•ˆë‚´</strong>
          <p class="muted" style="margin:6px 0 0">
            ê±°ë¶ì‹ë‹¹ì€ <b>ëŒ€ê¸°ì—…ì¶œì‹  ì˜ì–‘ì‚¬</b>ê°€ ì§ì ‘ ì˜ì–‘ ì„±ë¶„ì„ ê³ ë ¤í•˜ì—¬ ì‹ë‹¨ì„ êµ¬ì„±í•©ë‹ˆë‹¤.<br/>
            ê±°ë¶ì‹ë‹¹ê³¼ <b>ê±´ê°•í•œ ìŒì‹</b>, <b>ê±´ê°•í•œ ì§€ì‹</b>ì„ ì±„ì›Œë³´ì„¸ìš”.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- 2) Category bar -->
  <section class="cats">
    <div class="container">
      <div class="catbar">
        <a class="cat" href="#top" title="ê±°ë¶ì‹ë‹¹">
          <!-- ë¡œê³ ë§Œ (í…ìŠ¤íŠ¸ ì—†ìŒ) -->
          <img src="__LOGO__" alt="ê±°ë¶ì‹ë‹¹ ë¡œê³ " />
        </a>
        <a class="cat" href="#menu"><span>ì‹ë‹¨</span></a>
        <a class="cat" href="#news"><span>NEWS</span></a>
        <a class="cat" href="#board"><span>ì»¤ë®¤ë‹ˆí‹°</span></a>
        <a class="cat" href="#voices"><span>í˜„ì¥ì˜ ì†Œë¦¬</span></a>
        <a class="cat" href="#admin"><span>ê´€ë¦¬</span></a>
      </div>
    </div>
  </section>

  <!-- 3) Ad banner block -->
  <section class="ad-wrap">
    <div class="container ad-slot">
      <div class="ad-content">
        ê´‘ê³  ë°°ë„ˆ ì˜ì—­ â€” Mobile 320Ã—100 / Desktop 728Ã—90<br/>
        <span style="opacity:.7">ê´‘ê³  ì½”ë“œë¥¼ ì‚½ì…í•˜ë©´ ì´ ë°•ìŠ¤ê°€ ëŒ€ì²´ë©ë‹ˆë‹¤.</span>
      </div>
    </div>
  </section>

  <!-- 4) ë°”ë¡œ 'ì˜¤ëŠ˜ ì‹ë‹¨' ì‹œì‘ (ë¡œê³  ë°°ë„ˆ ì—†ìŒ) -->
  <section id="menu" class="container" style="margin-top:10px">
    <div class="toolbar">
      <div class="tabs" role="tablist" aria-label="ì‹ë‹¨ íƒ­">
        <button class="tab" id="tab-today" role="tab" aria-selected="true">ì˜¤ëŠ˜ ì‹ë‹¨</button>
        <button class="tab" id="tab-week" role="tab" aria-selected="false">ì´ë²ˆ ì£¼</button>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <span class="muted" id="weekLabel"></span>
        <button class="btn" id="prevWeek" title="ì´ì „ ì£¼">&larr;</button>
        <button class="btn" id="nextWeek" title="ë‹¤ìŒ ì£¼">&rarr;</button>
      </div>
    </div>

    <div id="panel-today" role="tabpanel">
      <div class="grid g2">
        <div class="card">
          <h2 id="todayTitle">ì˜¤ëŠ˜ ì‹ë‹¨</h2>
          <div class="weekday" id="todayMeals"></div>
        </div>
        <div class="card">
          <h3>ì•Œë ˆë¥´ê¸°/ì˜ì–‘ ì•ˆë‚´</h3>
          <p class="muted">ì›ì‚°ì§€Â·ì•Œë ˆë¥´ê¸° ì •ë³´ëŠ” ê° ë©”ë‰´ ì˜†ì— ì•„ì´ì½˜ìœ¼ë¡œ í‘œê¸°ë©ë‹ˆë‹¤.
            <span class="chip">ğŸŒ¶ ë§µê¸°</span> <span class="chip">ğŸ¥œ ê²¬ê³¼ë¥˜</span> <span class="chip">ğŸ¥› ìœ ì œí’ˆ</span> <span class="chip">ğŸŸ¢ ì±„ì‹</span></p>
        </div>
      </div>
    </div>

    <div id="panel-week" role="tabpanel" class="hidden">
      <div class="grid g3" id="weekGrid"></div>
    </div>
  </section>

  <!-- NEWS -->
  <section id="news" class="container" style="margin-top:34px">
    <div class="toolbar">
      <h2 style="margin:0">NEWS â€” ì œì¡°ì—… Â· ê²½ì œ Â· ì‚¬íšŒ</h2>
      <div style="display:flex;gap:8px">
        <select id="newsFilter" class="select" style="max-width:180px">
          <option value="all">ì „ì²´</option>
          <option value="ì œì¡°ì—…">ì œì¡°ì—…</option>
          <option value="ê²½ì œ">ê²½ì œ</option>
          <option value="ì‚¬íšŒ">ì‚¬íšŒ</option>
        </select>
        <input id="newsSearch" class="input" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰" style="max-width:220px"/>
      </div>
    </div>
    <div class="grid g3" id="newsList"></div>
    <div class="card muted" style="margin-top:8px">
      íŒ: ë‰´ìŠ¤ëŠ” ìš´ì˜ìê°€ <b>ë§í¬ì™€ ì œëª©</b>ì„ ì¶”ê°€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤(í´ë¦­ ìˆ˜ ì§‘ê³„). ì™¸ë¶€ í¬ë¡¤ë§ì€ í¬í•¨í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    </div>
  </section>

  <!-- BOARD (ì»¤ë®¤ë‹ˆí‹°) -->
  <section id="board" class="container" style="margin-top:34px">
    <div class="toolbar">
      <h2 style="margin:0">ì»¤ë®¤ë‹ˆí‹°</h2>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input id="boardSearch" class="input" placeholder="ê²€ìƒ‰ (ì œëª©/ë‚´ìš©/ë‹‰ë„¤ì„)" style="max-width:240px"/>
        <select id="boardFilter" class="select" style="max-width:160px">
          <option value="all">ì „ì²´</option>
          <option value="í˜„ì¥ë…¸í•˜ìš°">í˜„ì¥ë…¸í•˜ìš°</option>
          <option value="ì¥ë¹„/ê³µêµ¬">ì¥ë¹„/ê³µêµ¬</option>
          <option value="ì¼ìƒì¡ë‹´">ì¼ìƒì¡ë‹´</option>
        </select>
      </div>
    </div>

    <div class="grid g2">
      <div class="card">
        <h3>ê¸€ì“°ê¸°</h3>
        <div class="grid" style="grid-template-columns:1fr 1fr">
          <input id="nick" class="input" placeholder="ë‹‰ë„¤ì„"/>
          <select id="cat" class="select">
            <option>í˜„ì¥ë…¸í•˜ìš°</option>
            <option>ì¥ë¹„/ê³µêµ¬</option>
            <option>ì¼ìƒì¡ë‹´</option>
          </select>
        </div>
        <input id="title" class="input" placeholder="ì œëª©" style="margin-top:8px"/>
        <textarea id="body" class="textarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="clearForm">ì´ˆê¸°í™”</button>
          <button class="btn btn-accent" id="submitPost">ë“±ë¡</button>
        </div>
      </div>

      <div class="card">
        <h3>ìµœê·¼ ê¸€</h3>
        <div id="postList" class="grid"></div>
      </div>
    </div>
  </section>

  <!-- í˜„ì¥ì˜ ì†Œë¦¬: ì»¤ë®¤ë‹ˆí‹° ì¤‘ 'í˜„ì¥ë…¸í•˜ìš°' ì¹´í…Œê³ ë¦¬ í•˜ì´ë¼ì´íŠ¸ -->
  <section id="voices" class="container" style="margin-top:34px">
    <div class="toolbar">
      <h2 style="margin:0">í˜„ì¥ì˜ ì†Œë¦¬</h2>
      <p class="muted">ì»¤ë®¤ë‹ˆí‹°ì˜ <b>í˜„ì¥ë…¸í•˜ìš°</b> ì¹´í…Œê³ ë¦¬ì—ì„œ ìµœê·¼ ê¸€ 3ê°œë¥¼ ìë™ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
    </div>
    <div id="voicesList" class="grid g3"></div>
  </section>

  <!-- Admin -->
  <section id="admin" class="container" style="margin-top:34px">
    <div class="card">
      <h2>ê´€ë¦¬ì Â· ë°ì´í„° ê´€ë¦¬</h2>
      <details>
        <summary>ì£¼ê°„ ì‹ë‹¨ ì…ë ¥/ìˆ˜ì •</summary>
        <div class="muted" style="margin:6px 0 10px">í•´ë‹¹ ì£¼ì˜ ì‹ë‹¨ì„ ì…ë ¥í•˜ë©´ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤(ë¡œì»¬ìŠ¤í† ë¦¬ì§€). ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê³µìœ í•˜ë ¤ë©´ ì‚¬ì´íŠ¸ì— ì˜¬ë¦° ë’¤ JSONì„ ë‚´ë³´ë‚´ ì „ì†¡í•˜ì„¸ìš”.</div>
        <div class="grid g2">
          <div>
            <label class="muted">ì£¼ ì‹œì‘ ë‚ ì§œ(ì›”ìš”ì¼ ê¸°ì¤€)</label>
            <input type="date" id="weekStart" class="input"/>
          </div>
          <div>
            <label class="muted">ì‹ì‚¬(ì¡°/ì¤‘/ì„)Â·ìš”ì¼ë³„ ì…ë ¥</label>
            <select id="mealSelect" class="select">
              <option value="breakfast">ì¡°ì‹</option>
              <option value="lunch">ì¤‘ì‹</option>
              <option value="dinner">ì„ì‹</option>
            </select>
          </div>
        </div>
        <div class="grid g3" style="margin-top:8px" id="editDays"></div>
        <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
          <button class="btn" id="resetWeek">ì£¼ ì´ˆê¸°í™”</button>
          <button class="btn btn-accent" id="saveWeek">ì €ì¥</button>
        </div>
      </details>

      <details style="margin-top:16px">
        <summary>NEWS ì¶”ê°€/ê´€ë¦¬</summary>
        <div class="grid g2">
          <input id="newsTitle" class="input" placeholder="ê¸°ì‚¬ ì œëª©"/>
          <input id="newsUrl" class="input" placeholder="ë§í¬(https://)"/>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <select id="newsCat" class="select">
            <option>ì œì¡°ì—…</option>
            <option>ê²½ì œ</option>
            <option>ì‚¬íšŒ</option>
          </select>
          <button class="btn btn-accent" id="addNews">ì¶”ê°€</button>
          <button class="btn" id="exportNews">ë‰´ìŠ¤ JSON ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn" id="importNews">ê°€ì ¸ì˜¤ê¸°</button>
        </div>
      </details>

      <details style="margin-top:16px">
        <summary>ë°±ì—… Â· ì´ˆê¸°í™”</summary>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="exportAll">ëª¨ë“  ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn" id="importAll">ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn btn-danger" id="wipeAll">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
      </details>
    </div>
  </section>

  <footer>
    <div class="container">
      <div style="display:flex;align-items:center;gap:10px">
        <img src="__LOGO__" alt="ê±°ë¶ì‹ë‹¹ ë¡œê³ " style="height:22px;width:auto"/>
        <strong>ê±°ë¶ì‹ë‹¹</strong>
      </div>
      <div class="muted" style="margin-top:6px">Â© <span id="year"></span> Geobuk Dining â€” ëª¨ë°”ì¼ ë°˜ì‘í˜• ì‹ë‹¨Â·ì»¤ë®¤ë‹ˆí‹°</div>
    </div>
  </footer>

  <script>
  // ---------- Utilities ----------
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const fmtDate = d => new Date(d).toLocaleDateString('ko-KR', {month:'short', day:'numeric'});
  const today = new Date();
  const MON = d => {const n = new Date(d); const day=(n.getDay()+6)%7; n.setHours(0,0,0,0); n.setDate(n.getDate()-day); return n;}
  const weekKey = d => {const m=MON(d); return m.toISOString().slice(0,10)}; // YYYY-MM-DD (Mon)

  // ---------- Storage ----------
  const storage = {
    get(key, fallback){ try{ return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }catch(e){ return fallback } },
    set(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
  };

  // ---------- Sample Data ----------
  const SAMPLE_WEEK = (start) => {
    const labels = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
    const menu = { };
    for(let i=0;i<7;i++){ menu[i]={ breakfast:['í˜„ë¯¸ë°¥','ë¯¸ì†Œëœì¥êµ­','ê³„ë€ë§ì´','ê¹€ì¹˜','ë‘ìœ '], lunch:['ìŒ€ë°¥','ê°ˆë¹„ì°œ','ê³„ì ˆë‚˜ë¬¼','ê¹€ì¹˜','ê³¼ì¼'], dinner:['ì¡ê³¡ë°¥','ë‹­ê°€ìŠ´ì‚´êµ¬ì´','ìƒëŸ¬ë“œ','ê¹€ì¹˜','ìš”ê±°íŠ¸'] }; }
    menu[2].lunch.push('ë¹„ê±´ë‘ë¶€êµ¬ì´ ğŸŸ¢'); menu[4].lunch.push('ë§¤ìš´ë¼ì§€ë³¶ìŒ ğŸŒ¶');
    return { startISO:start.toISOString(), labels, menu };
  };

  // ---------- Menu Model ----------
  const MENU_DB_KEY = 'geobuk.menu';
  const ALL_MENU = storage.get(MENU_DB_KEY, {});
  function ensureWeek(d){ const key = weekKey(d); if(!ALL_MENU[key]) ALL_MENU[key] = SAMPLE_WEEK(MON(d)); return key; }

  // ---------- News Model ----------
  const NEWS_KEY = 'geobuk.news';
  const NEWS = storage.get(NEWS_KEY, [
    {title:'êµ­ë‚´ ì„¤ë¹„íˆ¬ì ë°˜ë“± ì¡°ì§', url:'https://example.com/a', cat:'ê²½ì œ', ts:Date.now()-86400000*2, clicks:0},
    {title:'ë°˜ë„ì²´ ê³µì • í˜ì‹  ì‚¬ë¡€', url:'https://example.com/b', cat:'ì œì¡°ì—…', ts:Date.now()-86400000*1, clicks:0},
    {title:'ì¶œí‡´ê·¼ ê°œì„ , ì‹œì°¨ì¶œê·¼ì œ í™•ëŒ€', url:'https://example.com/c', cat:'ì‚¬íšŒ', ts:Date.now()-86400000*3, clicks:0}
  ]);

  // ---------- Board Model ----------
  const BOARD_KEY = 'geobuk.board';
  const BOARD = storage.get(BOARD_KEY, []);

  // ---------- Menu UI ----------
  let currentWeekKey = ensureWeek(today);
  function setWeekLabel(){ const start = new Date(currentWeekKey); const end = new Date(start); end.setDate(start.getDate()+6); $('#weekLabel').textContent = fmtDate(start) + ' ~ ' + fmtDate(end); }

  function renderToday(){
    const wk = ALL_MENU[currentWeekKey]; if(!wk) return;
    const dow = (new Date().getDay()+6)%7; const labels = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
    $('#todayTitle').textContent = `ì˜¤ëŠ˜ ì‹ë‹¨ â€” ${labels[dow]}ìš”ì¼`;
    const meals = wk.menu[dow]; const wrap = $('#todayMeals'); wrap.innerHTML='';
    const groups = [['ì¡°ì‹','breakfast'],['ì¤‘ì‹','lunch'],['ì„ì‹','dinner']];
    for(const [label,key] of groups){ const list = meals[key]||[]; const box = document.createElement('div'); box.className='meal';
      box.innerHTML = `<h4>${label}</h4><div class="muted" style="font-size:14px">${list.length?list.join(' Â· '):'ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.'}</div>`; wrap.appendChild(box); }
  }

  function renderWeek(){
    const wk = ALL_MENU[currentWeekKey]; if(!wk) return;
    const labels = wk.labels; const grid = $('#weekGrid'); grid.innerHTML='';
    for(let i=0;i<7;i++){ const day = new Date(currentWeekKey); day.setDate(day.getDate()+i);
      const card = document.createElement('div'); card.className='card';
      const meals = wk.menu[i]; const isToday = weekKey(today)===currentWeekKey && ((today.getDay()+6)%7)===i;
      card.innerHTML = `<h3>${labels[i]}ìš”ì¼ ${isToday?'<span class="chip" style="margin-left:6px;background:var(--accent);color:#fff">ì˜¤ëŠ˜</span>':''}</h3>
        <div class="meal"><h4>ì¡°ì‹</h4><div class="muted">${(meals.breakfast||[]).join(' Â· ')||'â€”'}</div></div>
        <div class="meal" style="margin-top:6px"><h4>ì¤‘ì‹</h4><div class="muted">${(meals.lunch||[]).join(' Â· ')||'â€”'}</div></div>
        <div class="meal" style="margin-top:6px"><h4>ì„ì‹</h4><div class="muted">${(meals.dinner||[]).join(' Â· ')||'â€”'}</div></div>`;
      grid.appendChild(card);
    }
  }

  // Tabs
  $('#tab-today').addEventListener('click', ()=>{ $('#tab-today').setAttribute('aria-selected','true'); $('#tab-week').setAttribute('aria-selected','false'); $('#panel-today').classList.remove('hidden'); $('#panel-week').classList.add('hidden'); renderToday(); });
  $('#tab-week').addEventListener('click', ()=>{ $('#tab-week').setAttribute('aria-selected','true'); $('#tab-today').setAttribute('aria-selected','false'); $('#panel-week').classList.remove('hidden'); $('#panel-today').classList.add('hidden'); renderWeek(); });

  // Week navigation
  $('#prevWeek').addEventListener('click', ()=>{ const s=new Date(currentWeekKey); s.setDate(s.getDate()-7); currentWeekKey=ensureWeek(s); setWeekLabel(); renderWeek(); renderToday(); });
  $('#nextWeek').addEventListener('click', ()=>{ const s=new Date(currentWeekKey); s.setDate(s.getDate()+7); currentWeekKey=ensureWeek(s); setWeekLabel(); renderWeek(); renderToday(); });

  // ---------- Admin: Menu editing ----------
  function buildEditGrid(){
    const wrap = $('#editDays'); wrap.innerHTML=''; const labels=['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
    for(let i=0;i<7;i++){ const c=document.createElement('div'); c.className='card';
      c.innerHTML = `<strong>${labels[i]}ìš”ì¼</strong>
        <label class="muted" style="display:block;margin-top:6px">ë©”ë‰´(ì½¤ë§ˆë¡œ êµ¬ë¶„)</label>
        <input class="input" id="ed_${i}" placeholder="ì˜ˆ: ìŒ€ë°¥, ë¯¸ì†Œêµ­, ì œìœ¡ë³¶ìŒ, ê¹€ì¹˜"/>`; wrap.appendChild(c); }
  }
  buildEditGrid();

  function loadEditFields(){ const wk=ALL_MENU[currentWeekKey]; if(!wk) return; const mealKey = $('#mealSelect').value;
    for(let i=0;i<7;i++){ const list = (wk.menu[i][mealKey]||[]).join(', '); $('#ed_'+i).value = list; } }

  $('#mealSelect').addEventListener('change', loadEditFields);
  $('#weekStart').addEventListener('change', e=>{ const d = new Date(e.target.value); const m = MON(d); currentWeekKey = ensureWeek(m); setWeekLabel(); renderWeek(); renderToday(); loadEditFields(); });

  $('#saveWeek').addEventListener('click', ()=>{ const wk=ALL_MENU[currentWeekKey]; const mealKey=$('#mealSelect').value;
    for(let i=0;i<7;i++){ const v = $('#ed_'+i).value.trim(); wk.menu[i][mealKey] = v? v.split(',').map(s=>s.trim()).filter(Boolean) : []; }
    storage.set(MENU_DB_KEY, ALL_MENU); alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); renderToday(); renderWeek(); });

  $('#resetWeek').addEventListener('click', ()=>{ if(!confirm('í•´ë‹¹ ì£¼ì˜ ì‹ë‹¨ì„ ë¹„ì›ë‹ˆë‹¤. ê³„ì†í• ê¹Œìš”?')) return; const wk=ALL_MENU[currentWeekKey];
    for(let i=0;i<7;i++){ wk.menu[i]={breakfast:[],lunch:[],dinner:[]}; } storage.set(MENU_DB_KEY, ALL_MENU); loadEditFields(); renderToday(); renderWeek(); });

  // ---------- News ----------
  function renderNews(){
    const filter = $('#newsFilter').value; const q = $('#newsSearch').value.toLowerCase(); const box = $('#newsList'); box.innerHTML='';
    NEWS.slice().sort((a,b)=>b.ts-a.ts).filter(n=> (filter==='all'||n.cat===filter) && (n.title.toLowerCase().includes(q))).forEach(n=>{
        const card=document.createElement('div'); card.className='news-card';
        const date=new Date(n.ts).toLocaleDateString('ko-KR');
        card.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
            <div><a href="${n.url}" target="_blank" rel="noopener">${n.title}</a><div class="muted" style="font-size:12px">${n.cat} Â· ${date} Â· ì¡°íšŒ ${n.clicks||0}</div></div>
            <span class="chip">${n.cat}</span>
          </div>`;
        card.querySelector('a').addEventListener('click',()=>{ n.clicks=(n.clicks||0)+1; storage.set(NEWS_KEY, NEWS); renderNews(); });
        box.appendChild(card);
      });
  }
  $('#newsFilter').addEventListener('change', renderNews);
  $('#newsSearch').addEventListener('input', renderNews);
  $('#addNews').addEventListener('click', ()=>{
    const t=$('#newsTitle').value.trim(), u=$('#newsUrl').value.trim(), c=$('#newsCat').value;
    if(!t||!u){ alert('ì œëª©ê³¼ ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
    NEWS.push({title:t,url:u,cat:c,ts:Date.now(),clicks:0});
    storage.set(NEWS_KEY, NEWS);
    $('#newsTitle').value=''; $('#newsUrl').value=''; renderNews();
  });
  $('#exportNews').addEventListener('click',()=>{
    const blob = new Blob([JSON.stringify(NEWS,null,2)],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='news.json'; a.click(); URL.revokeObjectURL(url);
  });
  $('#importNews').addEventListener('click',()=>{
    const input=document.createElement('input'); input.type='file'; input.accept='application/json';
    input.onchange=e=>{ const f=e.target.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=()=>{ try{ const data=JSON.parse(r.result); NEWS.splice(0,NEWS.length,...data); storage.set(NEWS_KEY,NEWS); renderNews(); }catch(e){ alert('JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.'); } };
      r.readAsText(f);
    }; input.click();
  });

  // ---------- Board ----------
  function renderBoard(){
    const q = $('#boardSearch').value.toLowerCase();
    const f = $('#boardFilter').value;
    const box = $('#postList'); box.innerHTML='';
    BOARD.slice().sort((a,b)=>b.ts-a.ts).filter(p=> (f==='all'||p.cat===f) && (p.title+p.body+p.nick).toLowerCase().includes(q)).forEach(p=>{
        const div=document.createElement('div'); div.className='post';
        const date=new Date(p.ts).toLocaleString('ko-KR');
        div.innerHTML = `<div class="muted" style="font-size:12px">${p.cat} Â· ${p.nick} Â· ${date}</div>
          <strong>${p.title}</strong>
          <p style="white-space:pre-wrap;margin:6px 0 0">${p.body}</p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" data-like="${p.id}">ê³µê° ğŸ‘ <span>${p.likes||0}</span></button>
            <button class="btn" data-del="${p.id}">ì‚­ì œ</button>
          </div>`;
        div.querySelector('[data-like]').addEventListener('click',()=>{ p.likes=(p.likes||0)+1; storage.set(BOARD_KEY, BOARD); renderBoard(); });
        div.querySelector('[data-del]').addEventListener('click',()=>{ if(!confirm('ì´ ê¸€ì„ ì‚­ì œí• ê¹Œìš”?')) return;
          const idx=BOARD.findIndex(x=>x.id===p.id); if(idx>-1){ BOARD.splice(idx,1); storage.set(BOARD_KEY, BOARD); renderBoard(); } });
        box.appendChild(div);
      });
  }
  $('#submitPost').addEventListener('click',()=>{
    const nick=$('#nick').value.trim()||'ìµëª…', cat=$('#cat').value, title=$('#title').value.trim(), body=$('#body').value.trim();
    if(!title||!body){ alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
    BOARD.push({id:crypto.randomUUID(), nick, cat, title, body, ts:Date.now(), likes:0});
    storage.set(BOARD_KEY, BOARD);
    $('#title').value=''; $('#body').value=''; renderBoard(); renderVoices();
  });
  $('#clearForm').addEventListener('click',()=>{ $('#title').value=''; $('#body').value=''; });
  $('#boardSearch').addEventListener('input', renderBoard);
  $('#boardFilter').addEventListener('change', renderBoard);

  // ---------- Voices (í˜„ì¥ë…¸í•˜ìš° í•˜ì´ë¼ì´íŠ¸) ----------
  function renderVoices(){
    const box = $('#voicesList'); if(!box) return; box.innerHTML='';
    const pick = BOARD.filter(p=>p.cat==='í˜„ì¥ë…¸í•˜ìš°').slice().sort((a,b)=>b.ts-a.ts).slice(0,3);
    if(pick.length===0){ box.innerHTML = '<div class="muted">ì•„ì§ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤. ì»¤ë®¤ë‹ˆí‹°ì— ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</div>'; return; }
    pick.forEach(p=>{
      const d=document.createElement('div'); d.className='news-card';
      const date=new Date(p.ts).toLocaleDateString('ko-KR');
      d.innerHTML = `<strong>${p.title}</strong><div class="muted" style="font-size:12px">${p.nick} Â· ${date}</div>
        <p style="white-space:pre-wrap;margin:6px 0 0">${(p.body||'').slice(0,120)}${(p.body||'').length>120?'â€¦':''}</p>`;
      box.appendChild(d);
    });
  }

  // ---------- Backup / Restore ----------
  $('#exportAll').addEventListener('click',()=>{
    const blob = new Blob([JSON.stringify({ALL_MENU, NEWS, BOARD}, null, 2)], {type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='geobuk_backup.json'; a.click(); URL.revokeObjectURL(url);
  });
  $('#importAll').addEventListener('click',()=>{
    const input=document.createElement('input'); input.type='file'; input.accept='application/json';
    input.onchange=e=>{ const f=e.target.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=()=>{ try{
        const data=JSON.parse(r.result);
        Object.assign(ALL_MENU, data.ALL_MENU||{});
        NEWS.splice(0,NEWS.length, ...(data.NEWS||[]));
        BOARD.splice(0,BOARD.length, ...(data.BOARD||[]));
        storage.set(MENU_DB_KEY, ALL_MENU); storage.set(NEWS_KEY, NEWS); storage.set(BOARD_KEY, BOARD);
        setWeekLabel(); renderToday(); renderWeek(); renderNews(); renderBoard(); loadEditFields(); renderVoices();
      }catch(e){ alert('JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.'); } };
      r.readAsText(f);
    }; input.click();
  });
  $('#wipeAll').addEventListener('click',()=>{
    if(!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ê³„ì†í• ê¹Œìš”?')) return;
    localStorage.removeItem(MENU_DB_KEY); localStorage.removeItem(NEWS_KEY); localStorage.removeItem(BOARD_KEY);
    location.reload();
  });

  // ---------- Init ----------
  document.getElementById('year').textContent = new Date().getFullYear();
  function initWeek(){ const k = ensureWeek(new Date()); currentWeekKey = k; setWeekLabel(); renderToday(); renderWeek(); loadEditFields(); }
  initWeek(); renderNews(); renderBoard(); renderVoices();
  </script>
</body>
</html>
"""

html = html_template.replace("__LOGO__", data_uri)
out_path = "/mnt/data/geobuk_index_v3.html"
with open(out_path, "w", encoding="utf-8") as f:
    f.write(html)

out_path
